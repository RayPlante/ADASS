% This is the aspauthor.tex LaTeX file
% Copyright 2010, Astronomical Society of the Pacific Conference Series

\documentclass[11pt,twoside]{article}
\usepackage{asp2010}
\usepackage{enumitem}
\usepackage{graphicx}

\resetcounters

\bibliographystyle{asp2010}

\markboth{Smareglia, Knapic, Molinaro, Young and Valenti}{PESSTO@IA2}

\begin{document}

\title{Harmonize pipeline and archiving system: PESSTO@IA2 use case}
\author{Riccardo Smareglia$^1$, Cristina Knapic$^1$, Marco Molinaro$^1$, David Young$^2$ and Stefano Valenti$^3$
\affil{$^1$INAF Astronomical Observatory of Trieste, Italy}
\affil{$^2$Queen's University, Belfast, Northern Ireland, UK}
\affil{$^3$INAF Astronomical Observatory of Padova, Italy}}

\begin{abstract}
Italian Astronomical Archives Center (IA2) is a research infrastructure project that aims at coordinating different national and international initiatives to improve the quality of astrophysical data services. IA2 is now also involved in the PESSTO (Public ESO Spectroscopic Survey of Transient Objects) collaboration, developing a complete archiving system to store calibrated post processed data (including sensitive intermediate products), a user interface to access private data and Virtual Observatory (VO) compliant web services to access public fast reduction data via VO tools. The archive system shall rely on the PESSTO Marshall to provide file data and its associated metadata output by the PESSTO data-reduction pipeline. To harmonize the object repository, data handling and archiving system, new tools are under development. These systems must have a strong cross-interaction without increasing the complexities of any single task, in order to improve the performances of the whole system and must have a sturdy logic in order to perform all operations in coordination with the other PESSTO tools. MySQL Replication technology and triggers are used for the synchronization of new data in an efficient, fault tolerant manner. A general purpose library is under development to manage data starting from raw observations to final calibrated ones, open to overriding of different sources, formats, management fields, storing and publications policies. Configurations for all the system are stored on a dedicated schema (no configuration files), but can be easily updated by a planned Archiving System Configuration Interface (ASCI). 
\end{abstract}

\section{Introduction: IA2 \& PESSTO}

The IA2 data center \citep{molinaro_spie12}, hosted by INAF-OATs (Italian National Institute for Astrophysics - Astronomical Observatory of Trieste), fully manages data archiving, ingestion and user access for telescopes like the TNG (\textit{Telescopio Nazionale Galileo}, Galileo National Telescope), the LBT (Large Binocular Telescope) and the Asiago Astronomical Observatory (operated by the INAF-Astronomical Observatory of Padova). The data center also hosts mirror portals for other projects (e.g.the BaSTI, a Bag of Stellar Isochrones and Tracks, web portal) and is involved in surveys like GAPS (Global Architecture of Planetary Systems) and PESSTO (Public ESO Spectroscopic Survey for Transient Objects).

For the PESSTO survey IA2 is in charge of creating the full archive of processed data, that means preparing an archive structure able to map the pipeline from raw data to final products. Togheter with the archive, IA2 provides also data access to the PESSTO community (and other users) through a web GUI (Graphical User Interface) and VO services (initially based only on public survey products). The IA2 data center will also provide an easy release of final data to ESO (European Southern Observatory) for the so called \textit{Phase III} submission, i.e. validated science data ingestion.

In this paper we present the IA2 archive for PESSTO (Sec. \ref{ia2archive}), how it collaborates with the Marshall tool (Sec. \ref{ia2marshall}) and how data access is structured (Sec. \ref{dataaccess}) and, finally, conclusions on the current status and future developments.

\section{PESSTO@IA2 archive of processed data}\label{ia2archive}

The raw data from the survey observations are processed using a dedicated pipeline developed by S. Valenti. The pipeline produces two tipe of products:
\begin{itemize}[noitemsep,nolistsep]
	\item fast reduction public data (during night observations);
	\item final reduction underlying specific policy (at later time).
\end{itemize}
Reduction products are inserted by users in Marshall and pushed from there to IA2. 
To design the archive at IA2 a set of constraints have been used:
\begin{itemize}[noitemsep,nolistsep]
	\item the pipeline structure with intermediate and ancillary data products;
	\item retrieval use cases;
		\begin{itemize}[noitemsep,nolistsep]
			\item data selection from single survey run (all or part of);
			\item ESO \textit{Phase III} data set identification;
			\item single object retrieval with related data (raw, ancillary products);
			\item survey run identification;
			\item selection on different file type (i.e. flat, bias, ancillary etc.).
		\end{itemize}
	\item the pipeline insert into FITS products headers informations on products type, relations and references.
\end{itemize}
These constraints formed the basis for modelling the archive database (see Fig. \ref{fig:dbpipeline}).\\
Each pipeline product , final or intermediate, contains a FITS header coded keyword that defines the file type and its role in the data flux model. This key is decoded by a "model descriptor" present in a relational database (MySQL). All useful metadata for PESSTO use case are coded in a "data model" table, captured from FITS header and inserted in the appropriate database tables. Those tables are related each other in order to guarantee information consistency and references between raw data, intermediate, final and ancillary products. Files are appropriately stored in a highly available storage.
\articlefigure[]{P028_f1.eps}{fig:dbpipeline}{PESSTO data survey files, incoming from observation through the Marshall, are ingested according to the pipeline structure into a relational MySQL database while FITS metadata is stored in a set of observational and technical DB tables. Relationships exists also to raw data files (available from ESO archives). The main exposed section of the relational DB are the final objects (scientific data) output of the pipeline processing.}

\section{IA2 \& Marshall interaction}\label{ia2marshall}

PESSTO Marshall is the supervisor of the whole survey processing system, starting from observation schedule to object classification. PESSTO observers submit their data products to the Marshall application (developed at the Queen's University in Belfast) that registers the event and then pushes the data to IA2. Information of data insertion and storaging success should come back to Marshall. Since that, these two facilities need to interact to provide a homogenous and robust archiving system.
Interaction is performed taking strong advantage of MySQL Replication capability and the use of triggering systems. The main steps of the interaction involve:
\begin{itemize}[noitemsep,nolistsep]
	\item final products push to IA2, performed by Marshall
	\item data ingestion at IA2, triggered by DB backup replica
	\item IA2 reports ingestion status and file access URL to Marshall
	\item Marshall updates its system, triggered by DB replica
\end{itemize} 
At the end of the process the user, using either Marshall or IA2 portal, will be able to access and retrieve the data from the same position (physically located at IA2) in a transparent way.
This interaction between the two separated (also geographically) systems enables the two tools to provide their own functionalities (survey supervising and user access for the Marshall, data archiving and pipeline access for IA2 archive) while maintaining the data system always up to date.
Collaboration between IA2 and the Marshall goes further since the use of the replicated system is widened to a larger part of the Marshall DB to provide a backup system to the Marshall primary server. A spare endpoint will be provided by IA2 to PESSTO users, this spare Marshall system will be continously updated (both the interface system and the underlying DB) using a subversioning system and MySQL Replication.

\section{Data access}\label{dataaccess}

Once data are correctly ingested at IA2, the final products are visible (transparently for the user) both from the Marshall application and the IA2 web GUI or the VO compliant PESSTO web services (private data serving through VO is under study). The choice of one or the other interface depends on the query to perform:
\begin{itemize}[noitemsep,nolistsep]
	\item Marshall is "object classification" oriented;
	\item IA2 GUI is position, run and file search oriented;
	\item VO compliant web services are devoted to data interoperability at various scales and levels;
\end{itemize} 
Here we present the IA2 GUI (Sec. \ref{ia2web}) and the ongoing effort to publish the PESSTO data through the IVOA (International Virtual Observatory) protocols (Sec. \ref{vo}).

\subsection{IA2 web portal}\label{ia2web}

IA2 PESSTO Graphical User Interface is in charge to provide a wide range of selections with the use of many different types of filters. Initially it will serve a file subcollection based on final products metadata and will perform a dedicated query for the ESO \textit{Phase III} products release, but it is thought to provide selections also on intermediate and ancillary products, based on information codified in file names or to perform a subquery on specified final products ancillary files. 
It guarantees in any case the policy on private data and metadata using a dedicated authentication page while files release is hidden by a method (in the initial version, by a File Server, under developement, at final stage). The File Server will provide the Marshall with access to final products through IA2.
\subsection{VO services}\label{vo}

Besides the traditional web portal for data query and retrieval (described in the previous subsection \ref{ia2web}) the PESSTO data, at least the publicly available part of it, will be exposed through VO compliant web services. This solution well help users in exploiting the survey's data potential combining PESSTO results with other VO available astrophysical resources.
At present a couple of demo services are published using VO-Dance (\cite{molinaro_spie12}, the IA2 service publishing web application) and allow for a search through a catalog of PESSTO classified supernovae and a set of fast reduction spectra (based on the catalog set of objects). The two services\footnote{Simple Cone Search catalog is reachable at http://palantir18.oats.inaf.it:8080/ivoa/resources/cone/71 while Simple Spectral Access URl is http://palantir18.oats.inaf.it:8080/ivoa/resources/ssap/72} (consumable by VO aware client applications) will be upgraded, to dinamically expose all public PESSTO data, once the Marshall system and its interaction with IA2 will be at a stable manintainance status.

\section{Conclusions}

The IA2 PESSTO archive mapping the survey's pipeline products and its integration with the supervising Marshall application is currently in a starting production phase, with data ingestion ready but not with dynamic interaction set up in a stable way. Once the full system is up and running users will access PESSTO data through their preferred tool no matter where data are, simply selecting the desired result type (final products, raw data, runs, \dots) they want.
In this optic, IA2 has the role of consolidated distributed archiving system supplier, providing both data and infrastructure back-up storaging, data release and publishing.

From the VO point of view the deployed resources will be improved taking advantage of the Marshall and IA2 interaction, however an authentication mechanism for VO resources is under a study phase, to free the users from the proprietary data issue currently limiting the VO world.

\bibliography{../../editor}

\end{document}
