
\resetcounters

\bibliographystyle{asp2010}

\markboth{Fernique et al.}{HEALPix Based Cross-Correlation in Astronomy}

\title{\ssindex{libraries!HEALPix}HEALPix Based Cross-Correlation in Astronomy}
\author{Pierre~Fernique,$^1$ Daniel~Durand,$^2$ Thomas~Boch,$^1$ Ana\"is Oberto,$^1$ and Fran\c{c}ois-Xavier Pineau$^1$
\affil{$^1$Centre de Donn{\'e}es de Strasbourg, Strasbourg, France}
\affil{$^2$Herzberg Institute of Astrophysics, National Research Council, Canada}}

\aindex{Fernique, P.}
\aindex{Durand, D.}
\aindex{Boch, T.}
\aindex{Oberto, A.}
\aindex{Pineau, F.-X.}

\begin{abstract}
We are presenting our work on a cross correlation system based on \ssindex{libraries!HEALPix}HEALPix cells indexing. The system allows users to answer scientific questions like ``please find all \ssindex{observatories!space-based!HST}HST images on which there is an observation of a \ssindex{astronomy!radio}radio quiet quasar'' in a single query. The baseline of this system is the creation of the \ssindex{libraries!HEALPix}HEALPix indexes grouped hierarchically and organized in a special format file called MOC (see \url{http://ivoa.net/Documents/Notes/MOC}) developed by the\ssindex{Centre de Donn\'ees astronomiques de Strasbourg (CDS)} CDS. Using the MOC files, the cross correlation between images and or catalogues is reduced to searches only in meaningful areas. Under the condition that the survey database also internally uses a \ssindex{libraries!HEALPix}HEALPix positional index, the search result comes back almost immediately (typically a few seconds). We have started building the index for some surveys, catalogues (\ssindex{catalogs!services!VizieR}VizieR catalogues, \ssindex{databases!individual!Simbad}Simbad, etc.) and some pointed mode archives (like \ssindex{observatories!space-based!HST}HST at \ssindex{data centers!Canadian Astronomy Data Centre (CADC)}CADC) and are developing an elementary library to support basic operations on any input MOC files. The usage of the MOC files is starting to be used throughout the\ssindex{Virtual Observatory(VO)} VO community as a general indexing method and tools such as \ssindex{applications!Aladin}Aladin and \ssindex{applications!TOPCAT}TOPCAT are starting to make use of them.
\end{abstract}

\section{Selecting a Sky Index}
In this paper, we are presenting a very efficient method for answering questions like: find all \ssindex{observatories!space-based!HST}HST images on which there is an observation of a \ssindex{astronomy!radio}radio quiet quasar; find regions of the sky which have been observed both by \ssindex{observatories!space-based!HST}HST(optical), \ssindex{instruments!individual!SCUBA}SCUBA(mm), and \ssindex{observatories!space-based!XMM-Newton}XMM(X-rays); have my listed objects been already observed by \ssindex{observatories!space-based!Spitzer}Spitzer; or retrieve all \ssindex{observatories!Earth-based!2MASS}2MASS observations mapping my set of images. The key to answering these questions is to able to perform fast comparison of sky coverage between a series of observations or measurements. If we can easily generate spatial footprints from observations (either catalogues or pixel surveys) and operate basic operations such as an equality test, intersection, union, subtraction, and complement on these footprints, we will then have a solution for all these problems. Presently, most spatial searches on astronomical databases are based on simple cone queries, i.e. RA and Dec with a search radius. We need to do more and manipulate not only circles but complex areas on the sphere. The determination of a specific area on the celestial sphere is a classical geometric issue. The basic method consists of defining an area as the union of basic shapes (polygons, circles, etc.) on the sphere (along great and small circles) implemented by STC \citep{STC}. This method is simple but has one main disadvantage: there is no canonical form to describe a specific area, so comparison is difficult, often complex, and usually slow. We believe that a unique spatial index system is required if one wants to use the data from multiple sources, covering a vast number of collections. Fast methods are generally based on regular partitioning of the sphere (the sky) in regular cells with sizes adapted to the resolution of the input data and compare the ``presence'' or ``absence'' of sources (catalogues) or illumination (pixel data) in these cells. This process called \ssindex{methods!tessellation}tessellation is a well known mathematical tool designed to deal with spherical information. The three main ones used in astronomy are: the \ssindex{methods!indexing!Hierarchical Triangular Mesh (HTM)}Hierarchical Triangular Mesh \cite{HTM} (HTM), the Hierarchical Equal Area isoLatitude Pixelization \citep{Healpix} (\ssindex{libraries!HEALPix}HEALPix) and the \ssindex{methods!indexing!Q3C}Q3C \citep{quadtreee}. Even though these systems are similar, they are not compatible. So for keeping operations fast (intersection, union, etc.), we need to choose one of them. We have selected \ssindex{libraries!HEALPix}HEALPix as the \ssindex{methods!tessellation}tessellation system of choice. The reasons of our choice has been fully described in  \citep{Fernique}. In short, the main argument to select the \ssindex{libraries!HEALPix}HEALPix \ssindex{methods!tessellation}tessellation scheme is to be able to get cells covering equal area. The computation time is also a constant for a given cell/level which is not the case with \ssindex{methods!indexing!Hierarchical Triangular Mesh (HTM)}HTM. Also, the algorithm is quite simple and is already implemented in a number of languages and adopted for multiple missions  (\ssindex{observatories!space-based!WMAP}WMAP, \ssindex{observatories!space-based!Planck}PLANCK, \ssindex{observatories!space-based!Gaia}GAIA).


\section{Using the Sky Index}
After selecting \ssindex{libraries!HEALPix}HEALPix as the \ssindex{methods!tessellation}tessellation of choice, we derived from it four products: a multi-resolution visualization method, density maps (\ssindex{libraries!HEALPix}HEALPix map), coverage maps (MOC), and data \ssindex{data!access}access. The \ssindex{visualization}visualization system and density maps have been described in previous papers \citep{Fernique}, we will therefore discuss the MOC and data \ssindex{data!access}access.

\subsection{The Multi-Order Coverage Maps or MOC Files}
A MOC can be considered as a generic tool which can be used for various purposes. MOC files are \ssindex{libraries!HEALPix}HEALPix cell numbers packaged in a file for a given survey/catalogue in a \ssindex{data formats!FITS}FITS or ASCII file. The numbers are grouped recursively with the valid contiguous cell in a hierarchical way. This provides a simple and useful method of describing any sky area. As an example, the MOC file of an image from the \ssindex{instruments!individual!SCUBA}scuba (\ssindex{observatories!Earth-based!JCMT}JCMT) survey will only consist of the lowest resolution cells at the border since the inner part will contain only the few cells at the lowest resolution, thus the MOC file is quite small (see Figure~\ref{DurFig1}). For example, the MOC file for all the \ssindex{observatories!space-based!HST}HST images for filter F555 is only 180 Kbytes! As the operations on MOC are very fast (a few milliseconds), what is usually done with the MOC files is using some logic operators in order to create a ``resultant'' MOC file which contains the footprint of the answer. For example let's take two series of observations, A and B, and a catalogue C. The MOC operator could then perform operations on objects in\ssindex{computer languages!C} C which have $z >$ 2.0 or "give me all the areas of the sky observed by A and B". \articlefigure{part6/Durand_O13/O013_f2.eps}{DurFig1}{\ssindex{instruments!individual!SCUBA}Scuba I images showing MOC superposed.} The MOC encoding method has been described in an \ssindex{International Virtual Observatory Alliance (IVOA)}IVOA document and a \ssindex{computer languages!Java}Java library is available and already implemented in the well known\ssindex{Virtual Observatory(VO)} VO tools \ssindex{applications!Aladin}Aladin (\url{http://aladin.u-strasbg.fr}) and \ssindex{applications!TOPCAT}TOPCAT (\url{http://www.star.bris.ac.uk/~mbt/topcat/}).
\ooindex{Aladin, ascl:1112.019} 
\ooindex{TOPCAT, ascl:1101.010} 


\subsection{Data \ssindex{data!access}Access}
A MOC file itself does not retain the list of original files or sources it is describing, it is just a coverage descriptor. But under the condition that the original data providers have built their database index using the same \ssindex{libraries!HEALPix}HEALPix mechanism, \ssindex{data!access}access to original data becomes extremely efficient: each cell of MOC correspond to one index cell of the data base. To support this, the\ssindex{Centre de Donn\'ees astronomiques de Strasbourg (CDS)} CDS has re-indexed, using \ssindex{libraries!HEALPix}HEALPix, a large number of survey catalogues and provides a new service called "query by MOC" which is able to return all sources from one dedicated catalogue inside a MOC. Similarly, the \ssindex{data centers!Canadian Astronomy Data Centre (CADC)}CADC has been re-indexing all \ssindex{observatories!space-based!HST}HST images using the \ssindex{libraries!HEALPix}HEALPix method and generated not only the MOCs of these observations, but the list of input which was used to produce the MOC. This allows the user to get back the original image links at any moment while performing MOC operations.
%  \ssindex{projects!ASCL}ASCL question:  what library did he use? \ooindex{HEALPix, ascl:1107.018}  - no, method, not library

\section{Use Cases}
We studied a few use cases mostly to show the entirety of the processes which could be used to: create MOCs from various data sets (\ssindex{databases!individual!Simbad}Simbad, VizieR tables, pixel surveys like HST, \ssindex{surveys!Sloan Digital Sky Survey(SDSS)}SDSS, XMM); find all the \ssindex{astronomy!quasars}Quasars in \ssindex{surveys!Canada-France-Hawaii Telescope Legacy Survey (CFHTLS)}CFHTLS, not yet observed by SLOAN for with we have both an \ssindex{observatories!space-based!XMM-Newton}XMM and an \ssindex{observatories!space-based!HST}HST observations; or find all \ssindex{observatories!space-based!HST}HST infrared observations which coincide with bright NOMAD sources (see Figure~\ref{DurFig2}).

\articlefigure{part6/Durand_O13/O013_f3.eps}{DurFig2}{\ssindex{observatories!space-based!HST}HST image list and NOMAD sources inside a specific MOC (HST F606W)}

\section{What's Next}

We propose using the MOC files as defined to become an \ssindex{International Virtual Observatory Alliance (IVOA)}IVOA standard. The \ssindex{Virtual Observatory (VO)}Virtual Observatory project would greatly benefit from adopting a common indexing scheme for all the various types of data collections it embraces. An attractive but simple form of \ssindex{Virtual Observatory (VO)}virtual observatory user query is to request all records from the whole\ssindex{Virtual Observatory(VO)} VO at a given sky position. While this is in principle possible by dispatching one narrow positional query to every registered Cone Search, SSA or SIA service, in practice the number of queries required leads to an unacceptable load on both clients and servers, and moreover most of these queries will deliver no results because most services lack coverage in the queried region. If footprint information is available for all registered services, only those services with coverage in the region of interest, and hence which might provide a non-empty result set, could be easily identified, providing a great reduction in the number of service queries required. The MOC usage offers the opportunity to provide this coverage information in a uniform way. The MOC could be stored centrally or locally.

\bibliography{editor}
