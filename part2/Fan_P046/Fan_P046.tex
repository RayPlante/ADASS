% This is the aspauthor.tex LaTeX file
% Copyright 2010, Astronomical Society of the Pacific Conference Series

\documentclass[11pt,twoside]{article}
\usepackage{amsmath}
\usepackage{asp2010}
\resetcounters
%\bibliographystyle{asp2010}

\usepackage{threeparttable}
\markboth{Dongwei Fan and Tam\'as Budav\'ari}{Efficient Catalog Matching with Dropout Identification}

\begin{document}

\title{Efficient Catalog Matching with Dropout Identification}
\author{Dongwei Fan$^{1,2}$ and Tam\'as Budav\'ari$^2$}
\affil{$^1$National Astronomical Observatories, Chinese Academy of Sciences}
\affil{$^2$Department of Physics and Astronomy, The Johns Hopkins University}

\begin{abstract}
Base on the Zones Algorithm, we introduced a new catalog matching method which involves the sky coverage of catalogs. It benefits the matching between the catalogs with little overlapping area. Objects which were not inside the intersection area would be skipped to accelerate the matching. Moreover, the new method leads to a fast way to detect dropouts, i.e., the missing components that are in the observed regions of the sphere but did not reach the detection limit. These often provide invaluable insight into the spectral energy distribution of matched sources but rarely available in traditional associations.
\end{abstract}

\section{Introduction}
From the observation record, images and some other related information, the footprint (sky coverage) of a catalog could be extracted. It is helpful information for exploring the catalog. When two catalogs overlap each other in a small part, it would be a good chance to accelerate the crossmatching process. At this situation, the crossmatching could only be done in the overlapping region and ignore other part of their footprint.

This work tried to utilize the footprint information of catalogs. We introduced a new method to constrain crossmatching in the intersection region of catalogs, and make the whole process faster. The result of crossmatching and the overlap region also can be used on dropout identification. The objects without counter-part in specific regions could be found out from catalogs.

\section{Crossmatching with Spatial Constraints}
This work is mainly base on the Zones Algorithm ~\citep{DBLP:journals/corr/abs-cs-0701171} and the Footprint Service\footnote{\url{http://voservices.net/footprint/}} ~\citep{2007ASPC..376..559B}. The Zones Algorithm divides the celestial sphere to narrow constant declination rings (or call them "zones"). The detections are grouped into pre-defined zones by their \textit{ZoneID}, which can be calculated by their declination $\delta$ in equation~\ref{zoneid}. When matching catalogs, only have to consider sources in several neighbor zones as opposed to the whole sky, e.g. $ZoneID-1$, $ZoneID$ and $ZoneID+1$. This unique characteristic make it fast running on database system.
\begin{equation}\label{zoneid}
ZoneID=\lfloor{\frac{\delta + 90^\circ}{h}}\rfloor
\end{equation}

\begin{figure}
\begin{center}
\plottwo{P046_f2.eps}{P046_f3.eps}
\caption{{Left figure shows how to use intervals to imitate a hexagon on the sphere. In each zone that the sky coverage overlapped, the interval is a little larger than the sky coverage.}{Showdow in the right figure demonstrates how to use intervals to imitate the intersection of two footprints.}\label{P046_f2}}
\end{center}
\end{figure}

Every catalog has its footprint (sky coverage). The footprint will cover some pre-divided zones on the celestial sphere, and we could overlap it with many intervals of zones. An interval is a section in a zone, it has left and right boundary, its top and bottom boundary is the zone's top and bottom. For one zone, the footprint is zero (no intersection with the zone) or several intervals. So footprint could be imitated by zones' intervals, See left side of Fig.~\ref{P046_f2}. It is not a perfect overlap; it would be a little larger that the real sky coverage. We have to make sure that the intervals cover the whole footprint. Since the zone height is very tiny in practice, the intervals approximation could be very close to the footprint.

The purpose is intersecting the footprints of catalogs to fetch the overlay region. But directly intersect two footprints is complicated and time consuming. There is an alternative way: 1) imitate the footprints by lots of intervals; 2) to do the intervals' intersection by the intervals. The imitation still consumes a lot time, but the intervals' intersection is very simple and fast. The advantage is: what we need (the intersection) is easy to obtain, and the approximation process only have to do once. The footprints' intervals intersection could restrict the crossmatching - only calculate the objects inside the intervals. Once an object is outside the intersection, we can just skip it and test another object ~\citep{dongwei}. The footprints' intervals imitation could also be utilized in other crossmatchings or shape related calculations. The key is: DO NOT change the height of zone. Every footprint should be mapped to a same sphere-to-zones division. We could choose a tiny value, i.e. 7.1 arcseconds, and keep using this value. The influence of the constant zone-height is when we choose a threshold for the crossmatching larger than zone-height, i.e. 8.0 arcseconds, the neighbor zones should be expanded to $\left[\textit{ZoneID}-2,\textit{ZoneID}+2\right]$ to include all the possible matched objects. 

\section{Dropout Identification}
After crossmathing, we can efficiently find dropouts as well. Dropouts occur because of the different selection functions and other observational constraints. Sources in the footprint intersection that do not participate in associations are quickly identified by a simple set operation. i.e. from the new method, we could know: \textbf{Dataset1}, objects inside the footprint intersection of the \textit{Catalog1}; \textbf{Dataset2}, matched objects between the two catalogs. To do a simple subtract set operation, $\textbf{Dataset1}-\textbf{Dataset2}$ are the dropout objects.

\section{Performance}
Since our catalogs were all stored in databases. We implemented a version of the new method on the database system. The .net framework based Spherical Library\footnote{\url{http://voservices.net/spherical/}}~\citep{Budavari:2010ek, 2007cs........1163G} was chosen to do the geometry related calculations. In order to know the performance of the new method, we tested it on primary catalogs of \textbf{SDSS DR6} \& \textbf{GALEX GR3 AIS}. As Table\ref{tbl-1} shows~\footnote{all codes run on a machine with: Intel(R) Xeon(R) E5430 CPU @ 2.66GHz (2 Processors);24 GB Memory; Windows Server 2008 Datacenter Edition SP2; Microsoft SQL Server 2005 Developer Edition (64-bit).}, the new method has a $\textbf{20.3\%}$ acceleration comparing to the original Zones Algorithm.

The outline calculation part (a process to generate intervals) takes lots of time. But it only have to be calculated once, so it is still acceptable. For testing the effectiveness of new method, we cut the intersection region by R.A. ranges or Dec ranges to reduce the area. See left of Fig.\ref{P046_f4}, when intersection area reduced, time consumption of crossmatching also goes down.

After we finished the crossmatching between DR6 and AIS, we could use the dropout identification method to solve a problem: which objects belongs to AIS are inside DR6's coverage but do not have counter-part in DR6? let $N$ =\{select objects from AIS which inside the intersection area\}; $M$ =\{the matched objects between AIS \& DR6\} . $N-M$ is the answer : 4,211,169 objects, and it only takes 29 seconds. Reduced the intersection area to see the trend of the time consumption in dropout problem, we got graph at the right of Fig.~\ref{P046_f4}.

\begin{table}
  \centering
  \begin{threeparttable}[b]
\caption{Time performance of two methods\label{tbl-1}}
\begin{tabular}{rcc}
\tableline\tableline
Step & Zones Algorithm &  New Method\\
\tableline
ZoneDef &  00:02:08\tnote{1}& common proc.\\
Outlines\tnote{2} &  N/A & 05:48:27\\
Catalogs & 00:30:44& common proc.\\
Intervals Intersection & N/A & 00:00:06\\
ZoneZone &  00:01:01& common proc.\\
crossmatching & 00:06:48& 00:05:25\\
\tableline
\end{tabular}
 \begin{tablenotes}
    \item[1] time format in "hour:minute:second"
    \item[2] initial one-time process for intervals generation 
  \end{tablenotes}
 \end{threeparttable}
\end{table}

\begin{figure}
\begin{center}
\plottwo{P046_f4.eps}{P046_f5.eps}
\caption{{The left figure shows the new method's time consumption trends with area. When intersection area reduce, time consumption of cross matching goes down too.} {The right figure plots the performance of GR3 AIS catalog dropout identification. When intersection area goes down, time consumption of dropout identification also goes down.}\label{P046_f4}}
\end{center}
\end{figure}

\section{Conclusion}
With the footprint information of catalog, we built a new method on the Zones Algorithm to constraint crossmatching only in catalogs' overlapping area. Benefited by omitting the objects which were outside the intersection region, the crossmatching got a speedup. In order to get the intersection of two footprints, we approximate footprint by intervals of pre-divided zones. This process consumes lots of time, but only have to do once. The advantage is significant; the intervals intersection is much simpler and faster than the directly intersection calculation between footprints. Bases on this new method, the footprint intersection intervals and matched objects could be applied to rapidly identify dropout objects.

\bibliographystyle{asp2010}	% (uses file "plain.bst")
\bibliography{P046}		% expects file "myrefs.bib"
\end{document}
